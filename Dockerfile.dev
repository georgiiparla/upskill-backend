FROM ruby:3.2

WORKDIR /app

# Install dependencies
COPY Gemfile Gemfile.lock ./
RUN bundle config set --local path 'vendor/bundle'
RUN bundle install

# Copy the rest of the app
COPY . .

# Run migrations and start the server
EXPOSE 9292
CMD ["sh", "-c", "bundle exec rake db:migrate 2>/dev/null; bundle exec puma -b tcp://0.0.0.0:9292"]
